#===============================================================================
# Docker Compose File für die Produktivnutzung. Startet die folgenden Dienste:
#
#  * Ein MongoDB, die im internen Container-Netz für die anderen Container unter
#    dem Hostnamen "mongodb" auf dem Standardport 27017 erreichbar ist.
#
#  * Das REST-Backend der Anwendung, für welches ein auf nodeJS aufbauendes
#    Container-Image gebaut wird. Der REST-Webservice kann unter
#    http://localhost:3000 aufgerufen werden.
#
#  * Das Frontend der Anwendung, für welches ein auf nginx aufbauendes
#    Container-Image gebaut wird. Das Frontend kann unter der Adresse
#    http://localhost:8080 aufgerufen werden.
#
# Stand 02/2022 wäre es auch möglich gewesen, die Dienste für Entwicklung und
# Produktivbetrieb in einem einzigen Docker Compose File zu bündeln, und anhand
# von Profilen zu unterscheiden, ob die Entwicklungs- oder Produktivservices
# gestartet werden sollen. Vgl. https://docs.docker.com/compose/profiles/
# Dies wird aktuell aber noch nicht von dem unter Linux verbreiteten Tool
# "podman-compose" unterstützt, so dass wir hier weiterhin getrennte Dateien
# verwenden.
#===============================================================================
version: 3.9

services:
    # MongoDB-Datenbank
    mongodb:
        image: mongo
        restart: always
        environment:
            MONGO_INITDB_ROOT_USERNAME: dbuser
            MONGO_INITDB_ROOT_PASSWORD: dbpass
        volumes:
            - dbdata:/data/db
            - dbconfig:/data/configdb

    # Adressbuch-Backend (Produktivmodus)
    backend-prod:
        build:
            context: ./Backend
        environment:
            HOST: "::"
            PORT: 3000
            MONGODB: mongodb://dbuser:dbpass@mongodb:27017/
        ports:
            - 3000:3000

    # Adressbuch-Frontend (Produktivmodus)
    frontend-prod:
        build:
            context: ./Frontend
        ports:
            - 8080:8080

volumes:
    dbdata:
    dbconfig:
